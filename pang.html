<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pang - Texto Anárquico</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden;
      background: #111;
      color: #eee;
      font-family: sans-serif;
      position: relative;
    }
    .obj {
      position: absolute;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      padding: 20px;
      box-sizing: content-box;
      background-color: transparent;
      pointer-events: auto;
      display: inline-block;
      min-width: 40px;
      min-height: 40px;
      text-align: center;
    }
  </style>
</head>
<body>
<script>
(() => {
  const phrases = [
    "No tengo TDAH, tengo Instagram",
    "No eres tú, es Tik Tok",
    "Mi cerebro tras una hora de redes sociales",
  ];
  const phraseText = phrases[Math.floor(Math.random() * phrases.length)];
  const wordsArr = phraseText.split(' ');
  let objects = [];
  let state = 2; // start with letters

  function randVel() {
    return (Math.random() * 2 + 1) * (Math.random() < 0.5 ? -1 : 1);
  }

  function makeObj(text, x, y, vx, vy, type, group, index = null) {
    const el = document.createElement('div');
    el.className = 'obj';
    el.textContent = text;
    document.body.appendChild(el);
    const rect = el.getBoundingClientRect();
    el.dataset.type = type;
    el.dataset.group = group;
    if (index !== null) el.dataset.index = index;
    return { el, text, x, y, vx, vy, w: rect.width, h: rect.height, type, group, index };
  }

  function clearAll() {
    objects.forEach(o => o.el.remove());
    objects = [];
  }

  function initLetters() {
    clearAll();
    state = 2;
    wordsArr.forEach((w, wi) => {
      Array.from(w).forEach((l, i) => {
        const x = Math.random() * (window.innerWidth - 40);
        const y = Math.random() * (window.innerHeight - 40);
        objects.push(makeObj(l, x, y, randVel(), randVel(), 'letter', w));
      });
    });
  }

  function regroupLetters(group) {
    const letterObjs = objects.filter(o => o.type === 'letter' && o.group === group);
    if (letterObjs.length === 0) return;
    const avgX = letterObjs.reduce((s, o) => s + o.x, 0) / letterObjs.length;
    const avgY = letterObjs.reduce((s, o) => s + o.y, 0) / letterObjs.length;
    letterObjs.forEach(o => o.el.remove());
    objects = objects.filter(o => !(o.type === 'letter' && o.group === group));
    objects.push(makeObj(group, avgX, avgY, randVel(), randVel(), 'word', group));
    if (objects.filter(o => o.type === 'word').length === wordsArr.length) {
      state = 1;
    }
  }

  function collapsePhrase() {
    const wordObjs = objects.filter(o => o.type === 'word');
    if (wordObjs.length !== wordsArr.length) return;
    const avgX = wordObjs.reduce((s, o) => s + o.x, 0) / wordObjs.length;
    const avgY = wordObjs.reduce((s, o) => s + o.y, 0) / wordObjs.length;
    wordObjs.forEach(o => o.el.remove());
    objects = [];
    objects.push(makeObj(phraseText, avgX, avgY, randVel(), randVel(), 'phrase', null));
    state = 0;
  }

  document.body.addEventListener('click', e => {
    const target = objects.find(o => o.el === e.target);
    if (!target) return;
    if (target.type === 'letter') {
      regroupLetters(target.group);
    } else if (target.type === 'word') {
      collapsePhrase();
    } else if (target.type === 'phrase') {
      initLetters();
    }
  });

  function animate() {
    const W = window.innerWidth, H = window.innerHeight;
    objects.forEach(o => {
      o.x += o.vx;
      o.y += o.vy;
      if (o.w < W && (o.x < 0 || o.x + o.w > W)) o.vx *= -1;
      if (o.h < H && (o.y < 0 || o.y + o.h > H)) o.vy *= -1;
      o.el.style.transform = `translate(${o.x}px,${o.y}px)`;
    });
    requestAnimationFrame(animate);
  }

  window.addEventListener('resize', () => {
    objects.forEach(o => {
      o.x = Math.min(o.x, window.innerWidth - o.w);
      o.y = Math.min(o.y, window.innerHeight - o.h);
    });
  });

  // iniciar con letras
  initLetters();
  animate();
})();
</script>
</body>
</html>
